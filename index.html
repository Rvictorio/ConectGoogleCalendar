<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Calendar API Quickstart</title>
    <link rel="stylesheet" href="/Styles/style.css"> 
</head>
<body>
    <p>Agendamento com Google Calendar</p>

    <!-- Botões: Manipulação de login e ações -->
    <button id="authorize_button" onclick="handleAuthClick()">Autorização</button>
    <button id="signout_button" onclick="handleSignoutClick()">Sair do login</button>
    <button id="listar-agendas-btn">Listar Agendas</button>

    <div class="container">
        <h1>Criar Reunião no Google Calendar</h1>
        
        <!-- Formulário para inserir os detalhes da reunião -->
        <label for="titulo">Título:</label>
        <input type="text" id="titulo" name="titulo" required>

        <label for="dataInicio">Data de Início:</label>
        <input type="date" id="dataInicio" name="dataInicio" required>

        <label for="horaInicio">Hora de Início:</label>
        <input type="time" id="horaInicio" name="horaInicio" required>

        <label for="horaFim">Hora de Término:</label>
        <input type="time" id="horaFim" name="horaFim" required>

        <label for="participantes">Participantes (separados por vírgula):</label>
        <textarea id="participantes" name="participantes" rows="3" required></textarea>

        <button id="criarReuniao_button" onclick="criarReuniao()">Criar Reunião</button>

        <!-- Para exibir mensagens de sucesso ou erro -->
        <div id="mensagem"></div>

        <hr>

        <!-- Verificar reuniões -->
        <label for="emailUsuario">Email do Usuário:</label>
        <input type="email" id="emailUsuario" name="emailUsuario" required>

        <label for="dataCalendarUsuario">Escolha uma data para verificar reuniões:</label>
        <input type="date" id="dataCalendarUsuario" name="dataCalendarUsuario" required>
        <button onclick="verificarEExibirResultado()">Verificar Reuniões</button>
        <div id="mensagemVerificacao"></div>
    </div>

    <div id="agendas-list">
        <!-- Aqui será exibida a lista de agendas -->
    </div>

    <pre id="content" style="white-space: pre-wrap;"></pre>
    <script src="/Controller/script.js"></script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    <script>
        async function verificarEExibirResultado() {
            const emailUsuario = document.getElementById('emailUsuario').value;
            const dataCalendarUsuario = new Date(document.getElementById('dataCalendarUsuario').value);

            if (!emailUsuario) {
                document.getElementById('mensagemVerificacao').textContent = 'Por favor, insira um email válido.';
                return;
            }

            if (isNaN(dataCalendarUsuario.getTime())) {
                document.getElementById('mensagemVerificacao').textContent = 'Por favor, selecione uma data válida.';
                return;
            }

            const horariosReunioes = await obterHorariosReunioes(emailUsuario, dataCalendarUsuario);

            if (horariosReunioes.length > 0) {
                let mensagem = 'Horários das reuniões neste dia:\n';
                horariosReunioes.forEach((horario, index) => {
                    mensagem += `${index + 1}. Início: ${horario.inicio.toLocaleTimeString()}, Fim: ${horario.fim.toLocaleTimeString()}\n`;
                });
                document.getElementById('mensagemVerificacao').textContent = mensagem;
            } else {
                document.getElementById('mensagemVerificacao').textContent = 'Não há reuniões marcadas neste dia.';
            }
        }
    </script>
</body>
</html>
